{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"gpuType":"V28","authorship_tag":"ABX9TyOWTaRvr3+NujTssrGXi45h"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"},"widgets":{"application/vnd.jupyter.widget-state+json":{"1ffecce89c774af082718183d874562b":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_e0c9d134b7b642499e52e23b22af3211","IPY_MODEL_5f0dceb72023414ba59def5884bbc3fe","IPY_MODEL_a9fab417805d496d8bf0c54a31c70343"],"layout":"IPY_MODEL_7d4e966409a846ccb209c95fce3476f8"}},"e0c9d134b7b642499e52e23b22af3211":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_f5fac27645cc48fba1e8f1b1faecaf78","placeholder":"​","style":"IPY_MODEL_43503231212243c08bea4112a9b7bd50","value":"config.json: 100%"}},"5f0dceb72023414ba59def5884bbc3fe":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_1a72ad4d94fc4c6e94d887d8b8107563","max":69665,"min":0,"orientation":"horizontal","style":"IPY_MODEL_278e968edb564d4eabe88334ee4c1731","value":69665}},"a9fab417805d496d8bf0c54a31c70343":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_d1154f52b99b47e2bc659a6e885563d7","placeholder":"​","style":"IPY_MODEL_246fafba983b4d6b85ef5d2f90f348cf","value":" 69.7k/69.7k [00:00&lt;00:00, 724kB/s]"}},"7d4e966409a846ccb209c95fce3476f8":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"f5fac27645cc48fba1e8f1b1faecaf78":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"43503231212243c08bea4112a9b7bd50":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"1a72ad4d94fc4c6e94d887d8b8107563":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"278e968edb564d4eabe88334ee4c1731":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"d1154f52b99b47e2bc659a6e885563d7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"246fafba983b4d6b85ef5d2f90f348cf":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"4e57bdb42a094a0d86b7587e79cb1061":{"model_module":"@jupyter-widgets/controls","model_name":"HBoxModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HBoxModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HBoxView","box_style":"","children":["IPY_MODEL_07f78eeaa88640948993bf4f2b999ceb","IPY_MODEL_f028f6a6e53445899015573c3b94a7a6","IPY_MODEL_c09e612a8547445782851c67d2c5db04"],"layout":"IPY_MODEL_8c5a9fd3154241dd94dfba5f19494ea6"}},"07f78eeaa88640948993bf4f2b999ceb":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_9c60c2bfca0540e888a57c8937c68ef2","placeholder":"​","style":"IPY_MODEL_22833122a5f44b428acc0693d9c9e7f8","value":"model.safetensors: 100%"}},"f028f6a6e53445899015573c3b94a7a6":{"model_module":"@jupyter-widgets/controls","model_name":"FloatProgressModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"FloatProgressModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"ProgressView","bar_style":"success","description":"","description_tooltip":null,"layout":"IPY_MODEL_83f5bfce5b024a5fbc4fa620cd28f8a7","max":346293852,"min":0,"orientation":"horizontal","style":"IPY_MODEL_3153c731e0c444329cb4b0f0588e2877","value":346293852}},"c09e612a8547445782851c67d2c5db04":{"model_module":"@jupyter-widgets/controls","model_name":"HTMLModel","model_module_version":"1.5.0","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"HTMLModel","_view_count":null,"_view_module":"@jupyter-widgets/controls","_view_module_version":"1.5.0","_view_name":"HTMLView","description":"","description_tooltip":null,"layout":"IPY_MODEL_215c48c152fa43fa96e4bd0acaf2071c","placeholder":"​","style":"IPY_MODEL_72ef7d867cef431b9bc503b8bf2933b7","value":" 346M/346M [00:01&lt;00:00, 238MB/s]"}},"8c5a9fd3154241dd94dfba5f19494ea6":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"9c60c2bfca0540e888a57c8937c68ef2":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"22833122a5f44b428acc0693d9c9e7f8":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}},"83f5bfce5b024a5fbc4fa620cd28f8a7":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"3153c731e0c444329cb4b0f0588e2877":{"model_module":"@jupyter-widgets/controls","model_name":"ProgressStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"ProgressStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","bar_color":null,"description_width":""}},"215c48c152fa43fa96e4bd0acaf2071c":{"model_module":"@jupyter-widgets/base","model_name":"LayoutModel","model_module_version":"1.2.0","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"72ef7d867cef431b9bc503b8bf2933b7":{"model_module":"@jupyter-widgets/controls","model_name":"DescriptionStyleModel","model_module_version":"1.5.0","state":{"_model_module":"@jupyter-widgets/controls","_model_module_version":"1.5.0","_model_name":"DescriptionStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","description_width":""}}}},"accelerator":"TPU"},"cells":[{"cell_type":"code","source":["# non-highlight 파일을 highlight 파일 안에 넣어야 작동이 될겁니다,\n","# 즉, highlight 폴더 안에 goal, penatly, shots off target, shots on target, non-highlight 다섯 개의 세부 폴더가 있어야 합니다."],"metadata":{"id":"jT8LwuSC1woO"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["import os\n","import cv2\n","import torch\n","from torch.utils.data import Dataset, DataLoader\n","from torchvision import transforms\n","from transformers import ViTForImageClassification\n","from tqdm import tqdm\n","from PIL import Image\n","from google.colab import drive\n","\n","# Mount Google Drive\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"Xa09YlJEXFP_","executionInfo":{"status":"ok","timestamp":1732677566526,"user_tz":-540,"elapsed":55748,"user":{"displayName":"김영일","userId":"00898870763494157573"}},"outputId":"98c44523-6769-4d94-9cc6-54559d9ac19e"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":393,"referenced_widgets":["1ffecce89c774af082718183d874562b","e0c9d134b7b642499e52e23b22af3211","5f0dceb72023414ba59def5884bbc3fe","a9fab417805d496d8bf0c54a31c70343","7d4e966409a846ccb209c95fce3476f8","f5fac27645cc48fba1e8f1b1faecaf78","43503231212243c08bea4112a9b7bd50","1a72ad4d94fc4c6e94d887d8b8107563","278e968edb564d4eabe88334ee4c1731","d1154f52b99b47e2bc659a6e885563d7","246fafba983b4d6b85ef5d2f90f348cf","4e57bdb42a094a0d86b7587e79cb1061","07f78eeaa88640948993bf4f2b999ceb","f028f6a6e53445899015573c3b94a7a6","c09e612a8547445782851c67d2c5db04","8c5a9fd3154241dd94dfba5f19494ea6","9c60c2bfca0540e888a57c8937c68ef2","22833122a5f44b428acc0693d9c9e7f8","83f5bfce5b024a5fbc4fa620cd28f8a7","3153c731e0c444329cb4b0f0588e2877","215c48c152fa43fa96e4bd0acaf2071c","72ef7d867cef431b9bc503b8bf2933b7"]},"id":"ubsA8-KF-xiy","outputId":"5de5b2d2-a0ec-4df2-bdb9-5bb92252c311"},"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.10/dist-packages/huggingface_hub/utils/_auth.py:94: UserWarning: \n","The secret `HF_TOKEN` does not exist in your Colab secrets.\n","To authenticate with the Hugging Face Hub, create a token in your settings tab (https://huggingface.co/settings/tokens), set it as secret in your Google Colab and restart your session.\n","You will be able to reuse this secret in all of your notebooks.\n","Please note that authentication is recommended but still optional to access public models or datasets.\n","  warnings.warn(\n"]},{"output_type":"display_data","data":{"text/plain":["config.json:   0%|          | 0.00/69.7k [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"1ffecce89c774af082718183d874562b"}},"metadata":{}},{"output_type":"display_data","data":{"text/plain":["model.safetensors:   0%|          | 0.00/346M [00:00<?, ?B/s]"],"application/vnd.jupyter.widget-view+json":{"version_major":2,"version_minor":0,"model_id":"4e57bdb42a094a0d86b7587e79cb1061"}},"metadata":{}},{"output_type":"stream","name":"stderr","text":["Some weights of ViTForImageClassification were not initialized from the model checkpoint at google/vit-base-patch16-224 and are newly initialized because the shapes did not match:\n","- classifier.bias: found shape torch.Size([1000]) in the checkpoint and torch.Size([5]) in the model instantiated\n","- classifier.weight: found shape torch.Size([1000, 768]) in the checkpoint and torch.Size([5, 768]) in the model instantiated\n","You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.\n","Epoch 1/5: 100%|██████████| 30733/30733 [1:27:07<00:00,  5.88it/s]\n"]},{"output_type":"stream","name":"stdout","text":["Epoch 1/5, Loss: 0.3518979543039833\n"]},{"output_type":"stream","name":"stderr","text":["Epoch 2/5: 100%|██████████| 30733/30733 [1:26:48<00:00,  5.90it/s]\n"]},{"output_type":"stream","name":"stdout","text":["Epoch 2/5, Loss: 0.25359171517253754\n"]},{"output_type":"stream","name":"stderr","text":["Epoch 3/5: 100%|██████████| 30733/30733 [1:26:26<00:00,  5.93it/s]\n"]},{"output_type":"stream","name":"stdout","text":["Epoch 3/5, Loss: 0.2143027669502375\n"]},{"output_type":"stream","name":"stderr","text":["Epoch 4/5:  56%|█████▌    | 17250/30733 [48:27<38:04,  5.90it/s]"]}],"source":["# Configurations\n","class Config:\n","    model_name = \"google/vit-base-patch16-224\"\n","    num_classes = 5  # Goal, Penalty, Shots off target, Shots on target, non-highlight\n","    batch_size = 4\n","    num_epochs = 5\n","    learning_rate = 1e-4\n","    device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n","    data_dir = \"/content/drive/MyDrive/aix-딥러닝/SoccerNet/preprocessing/highlight\"  # Root folder for videos and highlights\n","    save_model_path = \"/content/drive/MyDrive/aix-딥러닝/vit_finetuned.pth\"\n","    frame_save_dir = \"/content/frames\"   # Directory to save extracted frames\n","\n","config = Config()\n","\n","# Ensure the frame save directory exists\n","os.makedirs(config.frame_save_dir, exist_ok=True)\n","\n","# Function to extract frames from videos\n","def extract_frames(video_path, output_dir, target_fps=5):\n","    cap = cv2.VideoCapture(video_path)\n","    fps = int(cap.get(cv2.CAP_PROP_FPS))  # Original FPS of the video\n","    frame_interval = max(1, fps // target_fps)  # Interval to extract frames for target FPS\n","\n","    count = 0\n","    frame_count = 0\n","\n","    while cap.isOpened():\n","        ret, frame = cap.read()\n","        if not ret:\n","            break\n","        if count % frame_interval == 0:\n","            frame_path = os.path.join(output_dir, f\"{os.path.basename(video_path)}_frame{frame_count}.jpg\")\n","            frame = cv2.resize(frame, (224, 224))  # Resize frame to 224x224\n","            cv2.imwrite(frame_path, frame)\n","            frame_count += 1\n","        count += 1\n","\n","    cap.release()\n","\n","# Preprocess the dataset to extract frames\n","for class_name in os.listdir(config.data_dir):\n","    class_dir = os.path.join(config.data_dir, class_name)\n","    frame_output_dir = os.path.join(config.frame_save_dir, class_name)\n","\n","    # 이미 프레임 디렉토리가 존재하고, 프레임이 있으면 건너뜀\n","    if os.path.exists(frame_output_dir) and len(os.listdir(frame_output_dir)) > 0:\n","        print(f\"Skipping frame extraction for class '{class_name}', frames already exist.\")\n","        continue\n","\n","    os.makedirs(frame_output_dir, exist_ok=True)\n","    for video_file in os.listdir(class_dir):\n","        video_path = os.path.join(class_dir, video_file)\n","        extract_frames(video_path, frame_output_dir)\n","\n","\n","# Custom Dataset\n","class SoccerDataset(Dataset):\n","    def __init__(self, root_dir, transform=None):\n","        self.root_dir = root_dir\n","        self.transform = transform\n","        self.data = []\n","        self.labels = []\n","\n","        # Folder names correspond to class labels\n","        self.class_names = {\"Goal\": 0, \"Penalty\": 1, \"Shots off target\": 2, \"Shots on target\": 3, \"non-highlight\": 4}\n","\n","        for class_name, label in self.class_names.items():\n","            class_dir = os.path.join(root_dir, class_name)\n","            for image_file in os.listdir(class_dir):\n","                self.data.append(os.path.join(class_dir, image_file))\n","                self.labels.append(label)\n","\n","    def __len__(self):\n","        return len(self.data)\n","\n","    def __getitem__(self, idx):\n","        image_path = self.data[idx]\n","        label = self.labels[idx]\n","        try:\n","            image = Image.open(image_path).convert(\"RGB\")\n","        except Exception as e:\n","            print(f\"Error loading image {image_path}: {e}\")\n","            raise\n","        if self.transform:\n","            image = self.transform(image)\n","        return image, label\n","\n","# Data Preparation\n","transform = transforms.Compose([\n","    transforms.Resize((224, 224)),\n","    transforms.ToTensor(),\n","    transforms.Normalize(mean=[0.5, 0.5, 0.5], std=[0.5, 0.5, 0.5])\n","])\n","\n","dataset = SoccerDataset(root_dir=config.frame_save_dir, transform=transform)\n","data_loader = DataLoader(dataset, batch_size=config.batch_size, shuffle=True)\n","\n","# Load Pretrained ViT\n","model = ViTForImageClassification.from_pretrained(\n","    config.model_name,\n","    num_labels=config.num_classes,\n","    ignore_mismatched_sizes=True  # To handle size mismatch\n",")\n","model.to(config.device)\n","\n","# Optimizer and Loss\n","optimizer = torch.optim.Adam(model.parameters(), lr=config.learning_rate)\n","criterion = torch.nn.CrossEntropyLoss()\n","\n","# Training Loop\n","def train():\n","    model.train()\n","    for epoch in range(config.num_epochs):\n","        total_loss = 0\n","        for images, labels in tqdm(data_loader, desc=f\"Epoch {epoch+1}/{config.num_epochs}\"):\n","            images, labels = images.to(config.device), labels.to(config.device)\n","\n","            optimizer.zero_grad()\n","            outputs = model(images).logits\n","            loss = criterion(outputs, labels)\n","            loss.backward()\n","            optimizer.step()\n","\n","            total_loss += loss.item()\n","\n","        print(f\"Epoch {epoch+1}/{config.num_epochs}, Loss: {total_loss/len(data_loader)}\")\n","\n","    # Save the model\n","    torch.save(model.state_dict(), config.save_model_path)\n","    print(f\"Model saved to {config.save_model_path}\")\n","\n","if __name__ == \"__main__\":\n","    train()\n"]}]}